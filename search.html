<!DOCTYPE html>
<html>
<head>
<link rel="stylesheet" type="text/css" href="stylesheet.css">
<style>
       #map {
        height: 400px;
        width: 75%;
       }
    </style>
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.js"></script> 

<title> Recommendations </title>
<script type="text/javascript" src="backend.js"></script>
</head>
<body>

<div class="navbar navbar-default navbar-static-top" id = "NavBar">
<ul>
  <li><a href="index.html" class="button"> HOME </a></li>
  <li><a href="search.html" class="button"> SEARCH </a></li>
  <li><a href="map.html" class="button"> MAP </a></li>
  <li><a href="results.html" class="button"> RESULTS </a></li>
</ul>
</div>

<h1> Search for what you want: </h1>
<center>

<form id="searchform" action="/search.html" method="POST" target="foo">
  <input type="text" name="location" placeholder="Search.." id="userinput">
  <p/>
  <p/>
 <p/>
  <select name="price" id="price_levels" > 
  	<option disabled selected value> Price Levels</option>
  	<option value="1" > $ </option>
  	<option value="2"> $$ </option>
  	<option value="3"> $$$ </option>
  	<option value="4"> $$$$ </option>
  </select>
  <p/>
   <button type="submit" >Submit! </button>
</form>

<!--
<div id="panel">
<input type="text" name="location" placeholder="location..." id="userinput">
 <p/>
  <p/>
 <p/>
 <select name="price" id="price_levels" > 
    <option disabled selected value> Price Levels</option>
    <option value="1" > $ </option>
    <option value="2"> $$ </option>
    <option value="3"> $$$ </option>
    <option value="4"> $$$$ </option>
  </select>
<p/>
  <button type="button" onclick="process_data()">Submit! </button>
</div>
-->
</center>

<div id = "map"></div>
<p id="searchval"></p>
<p id="priceval"></p>
<div id="results">
<p id="check1"></p>
<p id="textresults"></p>
<img id="image" style="width:100px;height:100px;">
<img id="rating">
<p id="check2"></p>
<p id="check4"></p>
<iframe id="foo"></iframe>
<h2></h2>
</div>


<script type="text/javascript">
/*
var info;

function process_data(){
  var location = document.getElementById("userinput").value;
  var price = document.getElementById("price_levels").value;

  document.getElementById("searchval").innerHTML = document.getElementById("userinput").value;
  document.getElementById("priceval").innerHTML = document.getElementById("price_levels").value;

  send_request(location, price);
}

function send_request(loc, pl){
   $.ajax({
      //url: 'https://guarded-taiga-83128.herokuapp.com/',
     url:'/search',
      type: 'POST',
      dataType:'json',
      data:{
        location: loc,
        price: pl
      },
      success:function(response){
        console.log("SUCCESS");
        var data = response;
        process_results(data);
      },
      error:function(XMLHttpRequest, textStatus, errorThrown) {
            console.log(textStatus + " : " + errorThrown);
      }
   });
}
*/



	$('#searchform').submit(function(e){
    e.preventDefault();
    $.ajax({
    	  data: $(this).serialize(),
       	type: 'POST',
        dataType:'json',
       	url: "https://guarded-taiga-83128.herokuapp.com/",
        success : function (response) {
            console.log("SUCCESS!");
            var data = response;
            process_results(data);
            //return data;
        },
        error: function(XMLHttpRequest, textStatus, errorThrown) {
            console.log(textStatus + " : " + errorThrown);
      }
    });
    return false;
});


  function initMap() {

       var latitude = parseFloat(info.coordinates.latitude);
        var longitude = parseFloat(info.coordinates.longitude);

        var uluru =new google.maps.LatLng(latitude, longitude);

        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 18,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });
      }

//data should be JSON
function process_results(data){
	var obj = JSON.parse(data);
  info = JSON.parse(data);
	document.getElementById("check2").innerHTML = "name " + obj.name;
	get_img_src(obj.rating);
	document.getElementById("check4").innerHTML = "phone " + obj.phone;
  document.getElementById("image").src = obj.image_url;

}

function get_img_src(rating){
  var src;
  switch(rating){
    case 0:
      src = "/images/0.png";
      break;
    case 1:
      src = "/images/1.png";
      break;
    case 1.5:
      src = "/images/1_half.png";
      break;
    case 2:
      src = "/images/2.png";
      break;
    case 2.5:
      src = "/images/2_half.png";
      break;
    case 3:
      src = "/images/3.png";
      break;
    case 3.5:
      src = "/images/3_half.png";
      break;
    case 4:
      src = "/images/4.png";
      break;
    case 4.5:
      src = "images/4_half.png";
      break;
    case 5:
      src = "/images/5.png";
      break;
  }
  document.getElementById("rating").src = src;
  localStorage.setItem("rating_src", src);

}

</script>

<script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAzU_JDzOxBsPCvWRWlq6fsd7PvVBYdmpw&callback=initMap">
    </script>


</body>
</html>
